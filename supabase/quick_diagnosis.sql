-- =========================================
-- å¿«é€Ÿè¨ºæ–·ï¼šæ‰¾å‡º 401 éŒ¯èª¤çš„æ ¹æœ¬åŸå› 
-- =========================================

-- é‡è¦ï¼šé€™å€‹æŸ¥è©¢æœƒé¡¯ç¤ºæ‰€æœ‰ token è¨˜éŒ„
-- è«‹æª¢æŸ¥ user_id æ˜¯å¦èˆ‡ä½ ç•¶å‰ç™»å…¥çš„å¸³è™Ÿç›¸ç¬¦
-- ä½ ç•¶å‰ç™»å…¥çš„ user_id æ˜¯ï¼šd7aa52d5-892d-488e-8dba-b20186879eb2

SELECT
    'ğŸ” è³‡æ–™åº«ä¸­çš„ Token è¨˜éŒ„' AS diagnosis,
    id,
    user_id,
    name,
    is_active,
    LENGTH(access_token_encrypted) AS token_length,
    CASE
        WHEN user_id = 'd7aa52d5-892d-488e-8dba-b20186879eb2' THEN 'âœ… èˆ‡ç•¶å‰ç™»å…¥ç”¨æˆ¶åŒ¹é…'
        ELSE 'âŒ user_id ä¸åŒ¹é…ï¼é€™å°±æ˜¯ 401 éŒ¯èª¤çš„åŸå› '
    END AS status,
    created_at,
    updated_at
FROM public.rm_line_channels
ORDER BY created_at DESC;

-- å¦‚æœä¸Šé¢æŸ¥è©¢çµæœæ˜¯ç©ºçš„ï¼ˆæ²’æœ‰è¨˜éŒ„ï¼‰ï¼Œè¡¨ç¤ºä½ éœ€è¦é‡æ–°ç¶å®š Token
-- å¦‚æœæœ‰è¨˜éŒ„ä½† status é¡¯ç¤ºã€ŒâŒ user_id ä¸åŒ¹é…ã€ï¼Œå‰‡éœ€è¦åˆªé™¤èˆŠè¨˜éŒ„å¾Œé‡æ–°ç¶å®š
